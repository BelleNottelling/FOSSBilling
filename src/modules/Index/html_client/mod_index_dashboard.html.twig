{% extends request.ajax ? "layout_blank.html.twig" : "layout_default.html.twig" %}

{% block meta_title %}{{ 'Client Area'|trans }}{% endblock %}
{% block page_header %}{{ 'Dashboard'|trans }}{% endblock %}

{% block body_class %}dashboard{% endblock %}
{% block breadcrumbs %}
    {% if not settings.hide_dashboard_breadcrumb %}
        <ul class="breadcrumb">
            <li><a href="{{ '/'|link }}">{{ 'Home'|trans }}</a> <span class="dropdown-divider">/</span></li>
            <li class="active">{{ 'Dashboard'|trans }}</li>
        </ul>
    {% endif %}
{% endblock %}

{% import "macro_functions.html.twig" as mf %}

{% block content %}
    {% if settings.showcase_enabled %}
        <div class="alert alert-info" role="alert">
            <p>{{ settings.showcase_text |markdown }}</p>

            {% if (settings.showcase_button_url) and (settings.showcase_button_title) %}
                <a class="btn btn-primary btn-large" href="{{ settings.showcase_button_url }}">{{ settings.showcase_button_title }}</a>
            {% endif %}
        </div>
    {% endif %}

{% if client %}
{% set tickets = client.support_ticket_get_list({ "status": 'on_hold' }) %}
{% if tickets.total > 0 %}
<div class="row">
<article class="span12 data-block">
<div class="data-container">
<header>
    <h2>{{ 'Tickets waiting your reply'|trans }}</h2>
</header>
<section id="slimScroll1">
    <table class="table table-striped table-bordered table-sm table-hover">
        <thead>
        <tr>
            <th>{{ 'Id'|trans }}</th>
            <th>{{ 'Subject'|trans }}</th>
            <th>{{ 'Help desk'|trans }}</th>
            <th>{{ 'Status'|trans }}</th>
            <th>{{ 'Last Updated'|trans }}</th>
            <th>{{ 'Actions'|trans }}</th>
        </tr>
        </thead>
        <tbody>
        {% for i, ticket in tickets.list %}
        <tr class="{{ cycle(['odd', 'even'], i) }}">
            <td>{{ ticket.id }}</td>
            <td><a href="{{ 'support/ticket'|link }}/{{ticket.id}}">{{ ticket.subject }}</a></td>
            <td>{{ ticket.helpdesk.name }}</td>
            <td><span class="badge">{{ mf.status_name(ticket.status) }}</span></td>
            <td title="{{ ticket.updated_at|format_datetime }}">{{ ticket.updated_at|timeago }} {{ 'ago'|trans }}</td>
            <td><a href="{{ 'support/ticket'|link }}/{{ticket.id}}" class="btn btn-small btn-dark">{{ 'Reply'|trans }}</a></td>
        </tr>
        {% else %}
        <tr>
            <td colspan="5">{{ 'The list is empty'|trans }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</section>
</div>
</article>
</div>
{% endif %}

<div class="container">
  <div class="row">
    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header">
          <h2>{{ 'Profile'|trans }}</h2>
        </div>
        <div class="card-body">
          <dl class="row">
            <dt class="col-sm-4">{{ 'ID'|trans }}</dt>
            <dd class="col-sm-8">#{{ profile.id }}</dd>
            <dt class="col-sm-4">{{ 'Email'|trans }}</dt>
            <dd class="col-sm-8">{{ profile.email }}</dd>
            <dt class="col-sm-4">{{ 'Balance'|trans }}</dt>
            <dd class="col-sm-8">{{ profile.balance | money(profile.currency) }}</dd>
          </dl>
        </div>
        <div class="card-footer">
          <a class="btn btn-dark" href="{{ 'client/profile'|link }}">{{ 'Update'|trans }}</a>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header">
          <h2>{{ 'Invoices'|trans }}</h2>
        </div>
        <div class="card-body">
          <dl class="row">
            <dt class="col-sm-4">{{ 'Total'|trans }}</dt>
            <dd class="col-sm-8">{{ client.invoice_get_list().total }}</dd>
            <dt class="col-sm-4">{{ 'Paid'|trans }}</dt>
            <dd class="col-sm-8">{{ client.invoice_get_list({ "status": "paid" }).total }}</dd>
            <dt class="col-sm-4">{{ 'Unpaid'|trans }}</dt>
            <dd class="col-sm-8">{{ client.invoice_get_list({ "status": "unpaid" }).total }}</dd>
          </dl>
        </div>
        <div class="card-footer">
          <a class="btn btn-dark" href="{{ 'invoice'|link }}">{{ 'All Invoices'|trans }}</a>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header">
          <h2>{{ 'Orders'|trans }}</h2>
        </div>
        <div class="card-body">
          <dl class="row">
            <dt class="col-sm-4">{{ 'Total'|trans }}</dt>
            <dd class="col-sm-8">{{ client.order_get_list({ "hide_addons": 1}).total }}</dd>
            <dt class="col-sm-4">{{ 'Active'|trans }}</dt>
            <dd class="col-sm-8">{{ client.order_get_list({ "hide_addons": 1, "status": "active" }).total }}</dd>
            <dt class="col-sm-4">{{ 'Expiring'|trans }}</dt>
            <dd class="col-sm-8">{{ client.order_get_list({ "expiring": 1 }).total }}</dd>
          </dl>
        </div>
        <div class="card-footer">
          <a class="btn btn-info order-button" href="{{ 'order'|link }}">{{ 'New order'|trans }}</a>
          <a class="btn btn-dark" href="{{ 'order/service'|link }}">{{ 'All orders'|trans }}</a>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header">
          <h2>{{ 'Tickets'|trans }}</h2>
        </div>
        <div class="card-body">
          <dl class="row">
            <dt class="col-sm-4">{{ 'Total'|trans }}</dt>
            <dd class="col-sm-8">{{ client.support_ticket_get_list().total }}</dd>
            <dt class="col-sm-4">{{ 'Open'|trans }}</dt>
            <dd class="col-sm-8">{{ client.support_ticket_get_list({ "status": 'open' }).total }}</dd>
            <dt class="col-sm-4">{{ 'On Hold'|trans }}</dt>
            <dd class="col-sm-8">{{ client.support_ticket_get_list({ "status": 'on_hold' }).total }}</dd>
          </dl>
        </div>
        <div class="card-footer">
          <a class="btn btn-info" href="{{ 'support'|link({ 'ticket': 1 }) }}">{{ 'New ticket'|trans }}</a>
          <a class="btn btn-dark" href="{{ 'support'|link }}">{{ 'All tickets'|trans }}</a>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header">
          <h2>{{ 'Recent orders'|trans }}</h2>
        </div>
        <div class="card-body">
            <table class="table table-striped table-bordered table-sm table-hover">
                <tbody>
                {% for i, order in client.order_get_list({ "per_page": 5, "page": request.page, "hide_addons": 1 }).list %}
                <tr class="{{ cycle(['odd', 'even'], i) }}">
                    <td>
                        <a href="{{ 'order/service/manage'|link }}/{{ order.id }}">{{ order.title|truncate(30) }}</a>
                    </td>
                    <td>
                        <span class="badge {% if order.status == 'active' %}badge-success{% elseif order.status == 'pending_setup' %}badge-warning{% endif %}">{{ mf.status_name(order.status) }}</span>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3">{{ 'The list is empty'|trans }}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header">
          <h2>{{ 'Tickets'|trans }}</h2>
        </div>
        <div class="card-body">
            <table class="table table-striped table-bordered table-sm table-hover">
                <tbody>
                    {% for i, email in client.email_get_list({ "per_page": 5 }).list %}
                    <tr class="{{ cycle(['odd', 'even'], i) }}">
                        <td><a href="{{ 'email'|link }}/{{ email.id }}">{{ email.subject|truncate(30) }}</a></td>
                        <td title="{{ email.created_at|format_date }}">{{ email.created_at|timeago }} {{ 'ago'|trans }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="2">{{ 'The list is empty'|trans }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}